<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寻宝大冒险</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0e6d6;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .game-container {
            width: 80%;
            max-width: 800px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        h1 {
            color: #8b4513;
            text-align: center;
        }
        
        .game-map {
            height: 400px;
            background-color: #e8f4f8;
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .player {
            width: 30px;
            height: 30px;
            background-color: #ff6b35;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 1s ease;
            z-index: 10;
        }
        
        .location {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        .library {
            background-color: #4a6fa5;
            top: 20%;
            left: 10%;
        }
        
        .temple {
            background-color: #c19a6b;
            top: 40%;
            left: 60%;
        }
        
        .forest {
            background-color: #2d8659;
            top: 70%;
            left: 30%;
        }
        
        .treasure {
            background-color: #d4af37;
            top: 30%;
            left: 80%;
        }
        
        .log-container {
            background-color: #f8f8f8;
            border-radius: 8px;
            padding: 15px;
            height: 150px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #8b4513;
        }
        
        .status {
            color: #333;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
        
        button {
            background-color: #8b4513;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #6d360f;
        }
        
        .animation-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            z-index: 100;
        }
        
        .show {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>寻宝大冒险</h1>
        <div class="status">点击开始按钮开始寻宝</div>
        <div class="game-map">
            <div class="location library">图书馆</div>
            <div class="location forest">森林</div>
            <div class="location temple">神庙</div>
            <div class="location treasure">宝藏</div>
            <div class="player"></div>
        </div>
        <div class="log-container" id="logContainer"></div>
        <button onclick="startAdventure()">开始寻宝</button>
        <div class="animation-overlay" id="animationOverlay"></div>
    </div>

    <script>
        // 扩展后的宝藏地图API
        class TreasureMap {
            static getInitialClue() {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve("在古老的图书馆里找到了第一个线索...");
                    }, 1000);
                });
            }
          
            static decodeAncientScript(clue) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (!clue) {
                            reject("没有线索可以解码!");
                        }
                        resolve("解码成功!发现宝藏可能藏在森林深处...");
                    }, 1500);
                });
            }
          
            // 新增：穿越森林
            static crossForest(location) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const random = Math.random();
                        if (random < 0.3) {
                            reject("糟糕!在森林里迷路了!");
                        }
                        resolve("成功穿越森林，前方发现一座古老的神庙...");
                    }, 2000);
                });
            }
          
            static searchTemple(location) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const random = Math.random();
                        if (random < 0.4) {
                            reject("糟糕!遇到了神庙守卫!");
                        }
                        resolve("在神庙中找到了一个神秘的箱子...");
                    }, 2000);
                });
            }
          
            // 新增：破解密码锁
            static crackCodeLock(box) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const random = Math.random();
                        if (random < 0.2) {
                            reject("密码错误，箱子被锁死了!");
                        }
                        resolve("成功破解密码锁，箱子可以打开了...");
                    }, 1500);
                });
            }
          
            static openTreasureBox() {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve("恭喜!你找到了传说中的宝藏!");
                    }, 1000);
                });
            }
        }

        // DOM元素
        const player = document.querySelector('.player');
        const logContainer = document.getElementById('logContainer');
        const statusElement = document.querySelector('.status');
        const animationOverlay = document.getElementById('animationOverlay');
        const startButton = document.querySelector('button');

        // 移动玩家到指定地点
        function movePlayerTo(locationClass) {
            return new Promise((resolve) => {
                const location = document.querySelector(`.${locationClass}`);
                const rect = location.getBoundingClientRect();
                const mapRect = document.querySelector('.game-map').getBoundingClientRect();
                
                player.style.top = `${rect.top - mapRect.top + 20}px`;
                player.style.left = `${rect.left - mapRect.left + 20}px`;
                
                // 等待动画完成
                setTimeout(resolve, 1000);
            });
        }

        // 添加日志
        function addLog(message) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = message;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // 显示动画覆盖层
        function showAnimation(text) {
            return new Promise((resolve) => {
                animationOverlay.textContent = text;
                animationOverlay.classList.add('show');
                setTimeout(() => {
                    animationOverlay.classList.remove('show');
                    resolve();
                }, 1500);
            });
        }

        // 使用async/await重写寻宝过程
        async function findTreasureWithAsyncAwait() {
            try {
                startButton.disabled = true;
                statusElement.textContent = "寻宝开始!";
                addLog("开始寻宝之旅...");
                
                // 前往图书馆
                await movePlayerTo('library');
                await showAnimation("探索图书馆...");
                const clue = await TreasureMap.getInitialClue();
                addLog(clue);
                statusElement.textContent = "在图书馆找到线索";
                
                // 解码古老文字
                await showAnimation("解码古老文字...");
                const forestLocation = await TreasureMap.decodeAncientScript(clue);
                addLog(forestLocation);
                statusElement.textContent = "解码成功，前往森林";
                
                // 前往森林并穿越
                await movePlayerTo('forest');
                await showAnimation("穿越森林...");
                const templeLocation = await TreasureMap.crossForest(forestLocation);
                addLog(templeLocation);
                statusElement.textContent = "成功穿越森林";
                
                // 前往神庙
                await movePlayerTo('temple');
                await showAnimation("搜索神庙...");
                const box = await TreasureMap.searchTemple(templeLocation);
                addLog(box);
                statusElement.textContent = "在神庙找到宝箱";
                
                // 破解密码锁
                await showAnimation("破解密码锁...");
                const unlocked = await TreasureMap.crackCodeLock(box);
                addLog(unlocked);
                statusElement.textContent = "密码破解成功";
                
                // 前往宝藏地点并打开宝箱
                await movePlayerTo('treasure');
                await showAnimation("打开宝箱...");
                const treasure = await TreasureMap.openTreasureBox();
                addLog(treasure);
                statusElement.textContent = "寻宝成功!";
                await showAnimation("恭喜找到宝藏!");
                
            } catch (error) {
                addLog(`任务失败: ${error}`);
                statusElement.textContent = "寻宝失败";
                await showAnimation(`失败: ${error}`);
            } finally {
                startButton.disabled = false;
            }
        }

        // 开始冒险
        function startAdventure() {
            // 重置游戏状态
            logContainer.innerHTML = '';
            player.style.top = '50%';
            player.style.left = '50%';
            findTreasureWithAsyncAwait();
        }
    </script>
</body>
</html>